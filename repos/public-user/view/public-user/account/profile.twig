{% do headLink().prependStylesheet(assetUrl('css/statistics.css', 'PublicUser')) %}
{% do headLink().prependStylesheet(assetUrl('css/iiif-storage.css', 'IIIFStorage')) %}
{% set theForm = form.prepare() %}
{% set sectionNavs = {'user-information': translate('User information'), 'change-password': translate('Password')} %}

{% if(messages) %}
    <div class="c-alerts c-alerts--secondary">
        <ul class="c-alerts__list">
            {% for messageList in messages %}
                {% for message in messageList %}
                    <li>{{ message }}</li>
                {% endfor %}
            {% endfor %}
        </ul>
    </div>
{% endif %}


{{ trigger('view.edit.before') }}
{{ form().openTag(form) | raw }}

{{ '<form method="POST" name="userForm" id="userForm">' | raw }}
<div class="c-dig-grid c-form">
    <div class="c-dig-grid__col--12">
        <h1>{{ pageTitle(translate('My account')) | raw }}</h1>
    </div>
    <div class="c-dig-grid__col--6">
        {{ trigger('view.edit.form.before', {'form': form }) }}
        <fieldset id="user-information" class="section active">
            <legend class="h3">{{ translate('User information') }}</legend>
            <p>
                {{ translate('Change your basic information here, you can follow the link to update your full profile.') }}
                <a href="{{ url('site/publicuser-profile-info', {}, true) }}">Edit full profile</a>
            </p>
            {{ formCollection(form.get('user-information'), false) }}
        </fieldset>
        <div id="page-actions">
            <button type="submit" class="c-button c-button--primary">{{ translate('Save details') }}</button>
        </div>
    </div>
    <div class="c-dig-grid__col--6">
        <fieldset id="change-password" class="section">
            <legend class="h3">{{ translate('Change password') }}</legend>
            <p>{{ translate('If you would like to change your password please enter a new password here, otherwise leave blank.') }}</p>
            {{ formCollection(form.get('change-password'), false) }}
        </fieldset>

        {{ trigger('view.edit.form.after', {'form': form }) }}
        <div id="page-actions">
            <button type="submit" class="c-button c-button--primary">{{ translate('Save new password') }}</button>
        </div>
    </div>
</div>
<div class="c-dig-grid c-form">
    <div class="c-dig-grid__col--12  c-dig-grid__col--last">

        {% if(statistics) %}
            <h2>Your statistics</h2>

            <div class="c-collection__statistics">
                <div class="c-statistics">
                    {% for statistic in statistics %}
                        <dl class="c-statistic c-statistic--sm">
                            <dt>{{ statistic.label }}</dt>
                            <dd>{{ statistic.value }}</dd>
                        </dl>
                    {% endfor %}
                </div>
            </div>

        {% endif %}

    </div>
</div>
{{ form().closeTag()| raw }}
{{ trigger('view.edit.after') }}

{% if(canvases) %}
    <h3>Your bookmarks</h3>
    <section class="iiif-view-manifest-list">
        {% for canvas in canvases %}
            {% set result = canvas.getJson() %}
            {% if result.partOf[0]['o:id'] and result['o:id'] %}
                <div class="iiif-view-manifest-list__canvas">
                    <div class="iiif-view-manifest-list__canvas-image">
                        <div class="c-image c-image--sm ">

                            <a href="/s/{{ slug }}/manifests/view/{{ result.partOf[0]['o:id'] }}/{{ result['o:id'] }}">
                                <div class="c-image__src">
                                    <img src="{{ result.thumbnail['@id'] }}"/>
                                </div>
                            </a>
                        </div>
                    </div>
                    <div class="iiif-view-manifest-list__canvas-label">
                        <a href="/s/{{ slug }}/manifests/view/{{ result.partOf[0]['o:id'] }}/{{ result['o:id'] }}">
                            {{ result.label }}
                        </a>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    </section>
{% else %}
    <h4>No bookmarks</h4>
{% endif %}
